import { VolumeProfile } from '../../src/volume-profile';
import { Extremums } from '../../src/providers/extremum';
import data from './data';

describe.only('Volume Profile', () => {
    it.only('Base working test', () => {
        const actual: Record<string, string> = {};
        const expected = {
            2.791: '+++++++++++++++',
            2.799: '---',
            2.81: '--',
            2.811: '---',
            2.814: '---',
            2.826: '--------',
            2.83: '-----',
            2.834: '--',
            2.835: '---',
            2.836: '---',
            2.839: '-',
            2.842: '------',
            2.843: '---',
            2.845: '-----',
            2.851: '--',
            2.853: '--',
            2.855: '---',
            2.857: '-----',
            2.858: '--',
            2.859: '--------',
            2.86: '---',
            2.862: '--',
            2.863: '---',
            2.864: '---',
            2.866: '-',
            2.867: '----',
            2.868: '--',
            2.869: '--',
            2.87: '-----',
            2.871: '--',
            2.872: '--',
            2.873: '--',
            2.874: '--',
            2.875: '--',
            2.876: '-',
            2.877: '---',
            2.878: '----',
            2.879: '-',
            2.88: '--',
            2.882: '-----',
            2.883: '------',
            2.884: '-----',
            2.885: '--',
            2.886: '--',
            2.887: '-------',
            2.889: '---',
            2.891: '----',
            2.894: '------',
            2.895: '------',
            2.896: '------',
            2.897: '-------',
            2.898: '---',
            2.899: '++++++++++++',
            2.9: '--',
            2.901: '----',
            2.902: '-----',
            2.903: '----',
            2.904: '-----',
            2.906: '--',
            2.908: '--',
            2.91: '----',
            2.912: '--',
            2.913: '-',
            2.914: '++++++++++++++++',
            2.915: '---',
            2.917: '----',
            2.918: '+++++++++++',
            2.92: '------',
            2.921: '------',
            2.922: '----',
            2.923: '-------',
            2.924: '---',
            2.925: '-',
            2.926: '----',
            2.927: '------',
            2.928: '--------',
            2.93: '----',
            2.931: '-',
            2.932: '-',
            2.933: '---',
            2.934: '--------',
            2.936: '+++++++++++++++++++++',
            2.938: '------',
            2.94: '+++++++++++',
            2.941: '--------',
            2.942: '-----',
            2.943: '--',
            2.944: '----------',
            2.945: '-----',
            2.946: '------',
            2.947: '----',
            2.948: '----',
            2.949: '+++++++++++',
            2.95: '----',
            2.951: '-------',
            2.952: '------',
            2.955: '+++++++++++++',
            2.956: '++++++++++++++',
            2.957: '------',
            2.958: '--------',
            2.96: '-------',
            2.963: '++++++++++++++++++',
            2.968: '-------',
        };

        function drawBar(count: number, isPeak = false) {
            const length = Math.round(count / 100_000);

            return new Array(length).fill(isPeak ? '+' : '-').join('');
        }

        const vp = new VolumeProfile(3);

        for (const candle of data) {
            vp.nextValue(candle);
        }

        const avg =  vp.getSessionAvg();
        const vpSession = vp.getSession();


        vpSession.forEach((volume, price) => {
            actual[price] =  drawBar(volume, volume > avg * 3.3);
        });

        console.log(actual);

        // expect(actual).toEqual(expected);
    });
});
